<!DOCTYPE html>
<html lang="en">

  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-154911146-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-154911146-1');
</script>
<script data-ad-client="ca-pub-5014618487406640" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5014618487406640"
     crossorigin="anonymous"></script>
    <title>Motor Speed Control Arduino</title>
    <meta charset="utf-8">
    <meta name = "description" content = "DC motor speed control PWM and Rotary encoder feedback using Arduino"  >
    <meta name = "keywords" content="Motor speed control, speed loop, Arduino rotary encoder, Arduino PWM, DC motor, PID controller, PID tuning,
                                        beginners , control theory, free tutorial">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="author" content="Geekee Ceebee ceebee1108@gmail.com">
    
   
    <title>GeeKee CeeBee - PID CONTROLLER</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="vendor/devicons/css/devicons.min.css" rel="stylesheet">
    <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/resume.min.css" rel="stylesheet">
    <link href="css/prism.css" rel="stylesheet" />
  </head>
<script data-ad-client="ca-pub-5014618487406640" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <body id="page-top">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
      <a class="navbar-brand js-scroll-trigger" href="index.html">
        <span class="d-block d-lg-none">GeeKee CeeBee</span>
        <span class="d-none d-lg-block">
          <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="img/logo.webp" alt="">
          <h3> <a class="text-dark" class="mb-0"  href="index.html" >HOME </a> </h3>


        </span>
      </a>




        </ul>
      </div>
    </nav>
    


    <div class="container-fluid p-0">

      <section class="resume-section p-3 p-lg-5 d-flex d-column" id="about">
        <div class="my-auto">
          <h1 class="mb-0">GeeKee
            <span class="text-primary">CeeBee</span>


          </h1>

          <p >Welcome to GeeKee CeeBee's Page: House of Mechatronics Projects & Lessons.<br />
            Contact Email: <a class="mb-0"  href="" >Ceebee1108@gmail.com </a><br />
              Follow me on <a class="mb-0"  href="https://www.youtube.com/c/GeeKeeCeeBee" >Youtube </a><br />
       

__________________________________________________________________________________________________________________________________</p>

            <style>
aside {
  width: 15%;

  padding-left: 15px;
  margin-left: 15px;
  float: right
  font-style: italic;
  font-style: bold;
  background-color: lightgray;
position: fixed;
right: 5px;

}


div.b {
  width: 50%;
  padding-bottom: 30px;

}
</style>




<aside>
<p> <h3 >Similar Projects</h3>

 <a class="mb-0"  href="DCMotor Position Tracking.html" ><u>1. DC Motor Position Control</u></a><br />
    <a class="mb-0"  href="Dual_Encoder.html" ><u>2. Anti-Backlash Motor Control </u> </a><br />
     <a class="mb-0"  href="index.html" ><u> More... </u></a>
</p>
</aside>

               <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
          <h2 >DC Motor Speed Control</h2>

          <img src="img/PID_tracking.gif" alt="" align= "Center" width="450" height="225" style="border:10px solid #bd5d38;border-radius: 2%;margin-bottom: 10px">
          <div class="b">

            Step by step practical guide to speed and position tracking control of a DC motor using Arduino.
            Formulate PID theory using Numerical Approximation method.
            Write PID code from scratch (Not using pre-written library).
            Demonstrate the use of rotary encoders, L298n motor driver, and timer interrupts.<br>
              Disclaimer: The code and other information on this project are provided on "AS IS" basis with no warranty. Please follow best practices and assess
              your own potential risks for this project.

            </div>




          <h3 >Components List</h3>
             <p class="mb-5">

            Arduino Uno (<a class="mb-0"  href="https://amzn.to/3aPaCQK">Affiliate Link</a>)<br>
            DC Motor with Optical Rotary Encoder (<a class="mb-0"  href="https://amzn.to/3cz5b9j">TS-25GA370</a>)<br>
            L298N Dual H-bridge Motor Driver (<a class="mb-0"  href="https://amzn.to/3B3Wu0F">Affiliate Link</a>)<br>
            DC Power Supply (6-12V) (<a class="mb-0"  href="https://amzn.to/3aOTYkr">Affiliate Link</a>)<br>
            Jumper Wires and Breadboard (<a class="mb-0"  href="https://amzn.to/3oeCzEz">Affiliate Link</a>)
            </p>

              </div>
          </div>

               <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
          <h3 >Step-by-step video guide</h3>

            <div class="b">
            In this video guide, you will learn how to control speed of any DC motor by controlling the supply voltage. Arduino Uno is used to perform PWM voltage control using the PID controller.
                     Video covers the encoder implementation, basic PID theory, implementation of Timer Interrupt and External Interrupts, derivation of control law, understanding the discrete methods of calculating
                     derivative and integration of error. Please watch the whole video for better understanding.
           </div>

          <iframe width="450" height="300" src="https://www.youtube.com/embed/QSIksPKndEs" frameborder="0" align = "center" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="border:10px solid #bd5d38;border-radius: 2%"></iframe>

              </div>
          </div>

                           <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
<!--           <p>__________________________________________________________________________________________________________________________________</p>-->
                  <h3 >Control Diagram</h3>
                        <div class="b">
            Rotary encoder feedback signal is used to determine the error speed between the reference speed and the actual motor speed. PID controller
                            simply controls the amount of voltage needed by the motor using PWM in order to reach the desired output.
           </div>

          <img src="img/PID_Control_Diagram.webp" alt="" align= "Center" width="450" height="250" style=" border:10px solid #bd5d38;border-radius: 2%">


         <br /><br />  <br /><br />

          <h3 >Wiring Diagram</h3>
                        <div class="b">
            Below is the wiring diagram for the components used in this project.
                            Pin2 and 3 are external ISR pins that trigger by the rotary encoder pulses. Pin6 is the PWM pin to control the amount of voltage sent
                            to the motor driver. Pin7 and 8 are used to change motor direction by changing the polarity of the supply voltage to the motor.
                            Make sure there's a common ground between the motor driver, arduino and external power supply.
           </div>

          <img src="img/PID_Schematic.webp" alt="" align= "Center" width="450" height="350" style=" border:10px solid #bd5d38;border-radius: 2%">


              </div>
          </div> <br /><br />
          <p>__________________________________________________________________________________________________________________________________</p>
            <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
          <h3 >Arduino Code</h3>
          <figure>
  <figcaption>PID Controller for DC Motor Speed Tracking </figcaption>
  <pre>
    <code class = "language-c">
//GeeKee CeeBee
// ************ DEFINITIONS************
float kp = 0.02;
float ki = 0.00015 ;
float kd = 0;

unsigned long t;
unsigned long t_prev = 0;

const byte interruptPinA = 2;
const byte interruptPinB = 3;
volatile long EncoderCount = 0;
const byte PWMPin = 6;
const byte DirPin1 = 7;
const byte DirPin2 = 8;

volatile unsigned long count = 0;
unsigned long count_prev = 0;

float Theta, RPM, RPM_d;
float Theta_prev = 0;
int dt;
float RPM_max = 230;

#define pi 3.1416
float Vmax = 6;
float Vmin = -6;
float V = 0.1;
float e, e_prev = 0, inte, inte_prev = 0;

//**********FUNCTIONS******************
//     Void ISR_EncoderA
//     Void ISR_EncoderB
//     Void Motor Driver Write
//     Timer Interrupt
//*************************************
void ISR_EncoderA() {
  bool PinB = digitalRead(interruptPinB);
  bool PinA = digitalRead(interruptPinA);

  if (PinB == LOW) {
    if (PinA == HIGH) {
      EncoderCount++;
    }
    else {
      EncoderCount--;
    }
  }

  else {
    if (PinA == HIGH) {
      EncoderCount--;
    }
    else {
      EncoderCount++;
    }
  }
}



void ISR_EncoderB() {
  bool PinB = digitalRead(interruptPinA);
  bool PinA = digitalRead(interruptPinB);

  if (PinA == LOW) {
    if (PinB == HIGH) {
      EncoderCount--;
    }
    else {
      EncoderCount++;
    }
  }

  else {
    if (PinB == HIGH) {
      EncoderCount++;
    }
    else {
      EncoderCount--;
    }
  }
}


float sign(float x) {
  if (x > 0) {
    return 1;
  } else if (x < 0) {
    return -1;
  } else {
    return 0;
  }
}

//***Motor Driver Functions*****

void WriteDriverVoltage(float V, float Vmax) {
  int PWMval = int(255 * abs(V) / Vmax);
  if (PWMval > 255) {
    PWMval = 255;
  }
  if (V > 0) {
    digitalWrite(DirPin1, HIGH);
    digitalWrite(DirPin2, LOW);
  }
  else if (V < 0) {
    digitalWrite(DirPin1, LOW);
    digitalWrite(DirPin2, HIGH);
  }
  else {
    digitalWrite(DirPin1, LOW);
    digitalWrite(DirPin2, LOW);
  }
  analogWrite(PWMPin, PWMval);
}

void setup() {
  Serial.begin(9600);
  pinMode(interruptPinA, INPUT_PULLUP);
  pinMode(interruptPinB, INPUT_PULLUP);
  attachInterrupt(digitalPinToInterrupt(interruptPinA), ISR_EncoderA, CHANGE);
  attachInterrupt(digitalPinToInterrupt(interruptPinB), ISR_EncoderB, CHANGE);
  pinMode(DirPin1, OUTPUT);
  pinMode(DirPin2, OUTPUT);

  cli();
  TCCR1A = 0;
  TCCR1B = 0;
  TCNT1 = 0;
  OCR1A = 12499; //Prescaler = 64
  TCCR1B |= (1 << WGM12);
  TCCR1B |= (1 << CS11 | 1 << CS10);
  TIMSK1 |= (1 << OCIE1A);
  sei();
}

void loop() {
  if (count > count_prev) {
    t = millis();
    Theta = EncoderCount / 900.0;
    dt = (t - t_prev);
    RPM_d = RPM_max * (sin(2 * pi * 0.005 * t / 1000.0))
        * sign(sin(2 * pi * 0.05 * t / 1000.0));
    if (t / 1000.0 > 100) {
      RPM_d = 0;
    }
    RPM = (Theta - Theta_prev) / (dt / 1000.0) * 60;
    e = RPM_d - RPM;
    inte = inte_prev + (dt * (e + e_prev) / 2);
    V = kp * e + ki * inte + (kd * (e - e_prev) / dt) ;
    if (V > Vmax) {
      V = Vmax;
      inte = inte_prev;
    }
    if (V < Vmin) {
      V = Vmin;
      inte = inte_prev;
    }


    WriteDriverVoltage(V, Vmax);

    Serial.print(RPM_d); Serial.print(" \t");
    Serial.print(RPM); Serial.print(" \t ");
    Serial.print(V); Serial.print("\t  ");
    Serial.print(e); Serial.println("  ");

    Theta_prev = Theta;
    count_prev = count;
    t_prev = t;
    inte_prev = inte;
    e_prev = e;
  }

}



ISR(TIMER1_COMPA_vect) {
  count++;
  Serial.print(count * 0.05); Serial.print(" \t");
}


    </code>
  </pre>
</figure>
 </div> </div>
          </ul>
        </div>
      </section>


        <footer class="page-footer font-small #040245 fixed-bottom">

  <!-- Copyright -->

  <div class="footer-copyright text-right py-3">

      <h3 class="font-weight-bold deep-orange-lighter-hover mb-3">Consider Supporting Me </h3>

      <form action="https://www.paypal.com/donate" method="post" target="_top">
<input type="hidden" name="hosted_button_id" value="FFXV3ZURVMFGA" />
<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
</form>


<!--    <a href="https://mdbootstrap.com/"> MDBootstrap.com</a>-->

  <!-- Copyright -->
 </div>
</footer>

<footer class="page-footer font-small blue">

  <!-- Copyright -->
  <div class="footer-copyright text-center py-3">© 2022 Copyright:
    <a href="http://GeekeeCeebee.com/"> GeekeeCeebee.com,</a>
      <a href="http://GeekeeCeebee.com/privacy.html"> Privacy Policy</a>
  </div>
  <!-- Copyright -->

</footer>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/resume.min.js"></script>
    <script src="js/prism.js"></script>
<!--         <script type="text/javascript"> var infolinks_pid = 3354734; var infolinks_wsid = 0; </script>
    <script type="text/javascript" src="//resources.infolinks.com/js/infolinks_main.js"></script> -->

  </body>

</html>
