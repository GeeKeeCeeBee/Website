<!DOCTYPE html>
<html lang="en">

  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-154911146-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-154911146-1');
</script>
<script data-ad-client="ca-pub-5014618487406640" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5014618487406640"
     crossorigin="anonymous"></script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    
   
    <title>GeeKee CeeBee - Anti-Backlash Dual Encoder Motor Position Control</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="vendor/devicons/css/devicons.min.css" rel="stylesheet">
    <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/resume.min.css" rel="stylesheet">
    <link href="css/prism.css" rel="stylesheet" />
  </head>
<script data-ad-client="ca-pub-5014618487406640" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <body id="page-top">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
      <a class="navbar-brand js-scroll-trigger" href="index.html">
        <span class="d-block d-lg-none">GeeKee CeeBee</span>
        <span class="d-none d-lg-block">
          <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="img/logo.jpg" alt="">
          <h3> <a class="text-dark" class="mb-0"  href="index.html" >HOME </a> </h3>

<!--           <a href="https://www.patreon.com/bePatron?u=67089441" data-patreon-widget-type="become-patron-button">Become a Patron!</a><script async src="https://c6.patreon.com/becomePatronButton.bundle.js"></script>
          		<br /><br /> -->

<!--                     <form action="https://www.paypal.com/donate" method="post" target="_top">
<input type="hidden" name="hosted_button_id" value="FFXV3ZURVMFGA" />
<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
</form>
<br /><br /> -->
        </span>
      </a>
      <!--<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#about">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#experience">Projects</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#education">Tutorial</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#skills">Skills</a>
          </li>



        </ul>
      </div>-->
    </nav>

<!--     <p style="right: 0px; position: fixed; text-align: center; top: 0px;"> <iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ac&ref=tf_til&ad_type=product_link&tracking_id=1111222204-20&marketplace=amazon&region=US&placement=B0792SBB5T&asins=B0792SBB5T&linkId=465deb2767b787ebdb64e6e3fd809a2b&show_border=true&link_opens_in_new_window=true&price_color=333333&title_color=0066c0&bg_color=ffffff">
     </iframe></p>

  <p style="right: 0px; position: fixed; text-align: center; top: 245px;">  <iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ac&ref=tf_til&ad_type=product_link&tracking_id=1111222204-20&marketplace=amazon&region=US&placement=B074WMHLQ4&asins=B074WMHLQ4&linkId=e655fac0bf20bd69f81f82cef4f77e1b&show_border=true&link_opens_in_new_window=true&price_color=333333&title_color=0066c0&bg_color=ffffff">
    </iframe></p>
   <p style="right: 0px; position: fixed; text-align: center; top: 490px;">   <iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ac&ref=tf_til&ad_type=product_link&tracking_id=1111222204-20&marketplace=amazon&region=US&placement=B07V5SKRGJ&asins=B07V5SKRGJ&linkId=7b875f25370e09802953de44e94c56db&show_border=true&link_opens_in_new_window=true&price_color=333333&title_color=0066c0&bg_color=ffffff">
     </iframe> </p>
  <p style="right: 125px; position: fixed; text-align: center; top: 0px;">  <iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ac&ref=tf_til&ad_type=product_link&tracking_id=1111222204-20&marketplace=amazon&region=US&placement=B07R4NK3D1&asins=B07R4NK3D1&linkId=4a387bc33e61db5cd8aebe674897ee9d&show_border=true&link_opens_in_new_window=true&price_color=333333&title_color=0066c0&bg_color=ffffff">
    </iframe></p>
  <p style="right: 125px; position: fixed; text-align: center; top: 245px;">  <iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ac&ref=tf_til&ad_type=product_link&tracking_id=1111222204-20&marketplace=amazon&region=US&placement=B01J1WZENK&asins=B01J1WZENK&linkId=aba79e600ef91dbeb430aa1e89c9020f&show_border=true&link_opens_in_new_window=true&price_color=333333&title_color=0066c0&bg_color=ffffff">
    </iframe></p>
  <p style="right: 125px; position: fixed; text-align: center; top: 490px;">  <iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ac&ref=tf_til&ad_type=product_link&tracking_id=1111222204-20&marketplace=amazon&region=US&placement=B073VDX4B7&asins=B073VDX4B7&linkId=39a53b3f7dd79e1a88b2b6d7969fa57e&show_border=true&link_opens_in_new_window=true&price_color=333333&title_color=0066c0&bg_color=ffffff">
    </iframe></p>    -->

    <div class="container-fluid p-0">

      <section class="resume-section p-3 p-lg-5 d-flex d-column" id="about">
        <div class="my-auto">
          <h1 class="mb-0">GeeKee
            <span class="text-primary">CeeBee</span>


          </h1>
         <!--  <div class="subheading mb-5">3542 Berry Street · Cheyenne Wells, CO 80810 · (317) 585-8468 ·
            <a href="mailto:name@email.com">name@email.com</a>
          </div>-->
          <p >Welcome to GeeKee CeeBee's Page: House of Mechatronics</p>
          <p>__________________________________________________________________________________________________________________________________</p>

            <style>
aside {
  width: 15%;

  padding-left: 15px;
  margin-left: 15px;
  float: right
  font-style: italic;
  font-style: bold;
  background-color: lightgray;
position: fixed;
right: 5px;

}


div.b {
  width: 50%;
  padding-bottom: 30px;

}
</style>




<aside>
<p> <h3 >Similar Projects</h3>

 <a class="mb-0"  href="DCMotor Position Tracking.html" ><u>1. DC Motor Position Control</u></a><br />
    <a class="mb-0"  href="PID Controller.html" ><u>2. DC Motor Speed Control</u></a><br />
     <a class="mb-0"  href="index.html" ><u> More... </u></a>
</p>
</aside>

               <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
          <h2 >Anti-Backlash Dual Encoder Motor Position Control</h2>

<!--          <img src="img/PID_tracking.gif" alt="" align= "Center" width="450" height="225" style="border:10px solid #bd5d38;border-radius: 2%;margin-bottom: 10px">-->
          <p class="mb-5">

            Step by step practical guide to Anti-backlash position tracking control of a DC motor+gearhead with backlash using Arduino Mega.<br>
            Dual encoder multi-loop control model for more accurate motor position control.<br>
            Write PID code from scratch (w/o using pre-writtern library). <br>
            Demonstrate the use of rotary encoders, L298n motor driver, interrupt service routine, multi-loop motor control.
            </p>

              </div>
          </div>

     <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
          <h3 >Components List</h3>
             <p class="mb-5">

            Arduino Mega ( No Uno/Nano: Need 4 ISR pins)<br>
            DC Motor with Encoder (TS-25GA370)<br>
            500CPR HEDS Encoder<br>
            1X Rotary Potentiometer<br>
            L298N Dual H-bridge Motor Driver<br>
            DC Power Supply (6-12V)<br>
            Jumper Wires
            </p>
    </div> </div>



     <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
          <h3 >Step-by-step video guide</h3>

            <div class="b">
   In this video, we will perform position control of a motor with gearhead that has backlash.
                We will use a dual encoder approach to reduce mechanical backlash for more accurate position control.
           </div>

          <iframe width="700" height="400" src="https://www.youtube.com/embed/QSIksPKndEs" frameborder="0" align = "center" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="border:10px solid #bd5d38;border-radius: 2%"></iframe>

    </div> </div>
          <br /><br />


                <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
          <h3 >Control Diagram</h3>

            <div class="b">
  We will start with just the motor which is our system. With given voltage, Motor will start to rotate, but to measure the angle of the motor shaft  we read the backend encoder of the motor.
                And figure out the error in our system. To correct this error, we add a PID controller.Now to correct position error caused by the backlash,  add 2nd encoder feedback to our system.
                Simply add a Proportional controller to compensate for the backlash error.
                This is called a dual loop control model. Where inner loop runs 5 times faster than the outer loop.
           </div>

          <img src="img/control_diagram.PNG" alt="" align= "Center" width="700" height="450" style=" border:10px solid #bd5d38;border-radius: 2%">
    </div> </div>
          <br /><br />
<!--           <p>__________________________________________________________________________________________________________________________________</p>-->

           <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
          <h3 >Wiring Diagram</h3>
          <img src="img/schematic_dual_encoder.PNG" alt="" align= "Center" width="700" height="600" style=" border:10px solid #bd5d38;border-radius: 2%">

</div> </div>
         <br /><br />
          <p>__________________________________________________________________________________________________________________________________</p>
            <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
          <h3 >Arduino Code</h3>
          <figure>
  <figcaption>Anti-Backlash Dual Encoder Motor Position Control </figcaption>
  <pre>
    <code class = "language-c">
//GeeKee CeeBee


float kp = 1;
float ki = 0.0;
float kd = 40;
float Vmax = 10;
float Vmin = -10;
float V = 0.1;
long timer = 0;
unsigned long t;
unsigned long t_prev = 0;
int16_t e, e_prev,inte,inte_prev,error2, error2_prev, interror2;
const byte interruptPinA = 2;
const byte interruptPinB = 3;
const byte interruptPin2A = 18;
const byte interruptPin2B = 19;
volatile long EncoderCount = 0;
volatile long EncoderCount2 = 0;
float Theta, Theta2, RPM, RPM_d;
float MPU_angle;
int Theta_prev = 0;
int dt;
const byte PWMPin = 6;
const byte DirPin1 = 7;
const byte DirPin2 = 8;

void ISR_EncoderA() {
  bool PinB = digitalRead(interruptPinB);
  bool PinA = digitalRead(interruptPinA);

  if (PinB == LOW) {
    if (PinA == HIGH) {
      EncoderCount++;
    }
    else {
      EncoderCount--;
    }
  }

  else {
    if (PinA == HIGH) {
      EncoderCount--;
    }
    else {
      EncoderCount++;
    }
  }
}

void ISR_EncoderB() {

  bool PinB = digitalRead(interruptPinA);
  bool PinA = digitalRead(interruptPinB);

  if (PinA == LOW) {
    if (PinB == HIGH) {
      EncoderCount--;
    }
    else {
      EncoderCount++;
    }
  }

  else {
    if (PinB == HIGH) {
      EncoderCount++;
    }
    else {
      EncoderCount--;
    }
  }
}

void ISR_Encoder2A() {
  bool PinB = digitalRead(interruptPin2B);
  bool PinA = digitalRead(interruptPin2A);

  if (PinB == LOW) {
    if (PinA == HIGH) {
      EncoderCount2++;
    }
    else {
      EncoderCount2--;
    }
  }

  else {
    if (PinA == HIGH) {
      EncoderCount2--;
    }
    else {
      EncoderCount2++;
    }
  }
}


void ISR_Encoder2B() {

  bool PinB = digitalRead(interruptPin2A);
  bool PinA = digitalRead(interruptPin2B);

  if (PinA == LOW) {
    if (PinB == HIGH) {
      EncoderCount2--;
    }
    else {
      EncoderCount2++;
    }
  }

  else {
    if (PinB == HIGH) {
      EncoderCount2++;
    }
    else {
      EncoderCount2--;
    }
  }
}

void WriteDriverVoltage(float V, float Vmax) {
  int PWMval = int(255 * abs(V) / Vmax);
  if (PWMval > 255) {
    PWMval = 255;
  }
  if (V > 0) {
    digitalWrite(DirPin1, HIGH);
    digitalWrite(DirPin2, LOW);
  }
  else if (V < 0) {
    digitalWrite(DirPin1, LOW);
    digitalWrite(DirPin2, HIGH);
  }
  else {
    digitalWrite(DirPin1, LOW);
    digitalWrite(DirPin2, LOW);
  }
  analogWrite(PWMPin, PWMval);
}

void setup() {
  Serial.begin(9600);
  pinMode(interruptPinA, INPUT_PULLUP);
  pinMode(interruptPinB, INPUT_PULLUP);
  pinMode(interruptPin2A, INPUT_PULLUP);
  pinMode(interruptPin2B, INPUT_PULLUP);
  attachInterrupt(digitalPinToInterrupt(interruptPinA), ISR_EncoderA, CHANGE);
  attachInterrupt(digitalPinToInterrupt(interruptPinB), ISR_EncoderB, CHANGE);
  attachInterrupt(digitalPinToInterrupt(interruptPin2A), ISR_Encoder2A, CHANGE);
  attachInterrupt(digitalPinToInterrupt(interruptPin2B), ISR_Encoder2B, CHANGE);
  pinMode(DirPin1, OUTPUT);
  pinMode(DirPin2, OUTPUT);
  pinMode(A0, INPUT);
  Serial.println("Target, Difference, Theta2, Theta");
}

void loop() {
int target = map(analogRead(A0),0,1023,-90,90);
Theta2 = EncoderCount2/5.689;

for (int i=0; i<5; i++)  {
    t = millis();
    Theta = EncoderCount/6 ;
    dt = (t - t_prev);
    e = target - Theta;
    inte = inte_prev + (dt * (e + e_prev) / 2);
    V = kp * e + ki * inte + (kd * (e - e_prev) / dt) ; // Controlling Function
      if (V > Vmax) {
        V = Vmax;
        inte = inte_prev;
      }
      if (V < Vmin) {
        V = Vmin;
        inte = inte_prev;
        // val_prev= val;
      }
    WriteDriverVoltage(V, Vmax);
    Theta_prev = Theta;
    t_prev = t;
    inte_prev = inte;
    e_prev = e;
    delay(2);
}

error2 = target - Theta2;
V = 1.5 *error2;  ///using proportional controller with P-gain
WriteDriverVoltage(V, Vmax);

Serial.print(target);Serial.print(" ,");
Serial.print(Theta-Theta2);Serial.print(",");
 Serial.print(Theta2); Serial.print(" ,");
Serial.println(Theta);
delay(4);
}


    </code>
  </pre>
</figure>
 </div> </div>
          </ul>
        </div>
      </section>


        <footer class="page-footer font-small #040245 fixed-bottom">

  <!-- Copyright -->

  <div class="footer-copyright text-right py-3">

      <h3 class="font-weight-bold deep-orange-lighter-hover mb-3">Consider Supporting Me </h3>

      <form action="https://www.paypal.com/donate" method="post" target="_top">
<input type="hidden" name="hosted_button_id" value="FFXV3ZURVMFGA" />
<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
</form>


<!--    <a href="https://mdbootstrap.com/"> MDBootstrap.com</a>-->

  <!-- Copyright -->
 </div>
</footer>

<footer class="page-footer font-small blue">

  <!-- Copyright -->
  <div class="footer-copyright text-center py-3">© 2022 Copyright:
    <a href="http://GeekeeCeebee.com/"> GeekeeCeebee.com,</a>
      <a href="http://GeekeeCeebee.com/privacy.html"> Privacy Policy</a>
  </div>
  <!-- Copyright -->

</footer>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/resume.min.js"></script>
    <script src="js/prism.js"></script>
<!--         <script type="text/javascript"> var infolinks_pid = 3354734; var infolinks_wsid = 0; </script>
    <script type="text/javascript" src="//resources.infolinks.com/js/infolinks_main.js"></script> -->

  </body>

</html>
